<div class="sidebar position-fixed d-flex flex-column vh-100" id="sidebar">
    <!-- Modern Brand Header -->
    <div class="sidebar-header">
        <a href="{% url 'properties:property_list' %}" class="brand-link">
            <div class="brand-icon">
                <i class="bi bi-buildings"></i>
            </div>
            <div class="brand-text">
                <h1 class="brand-title">InmoGest</h1>
                <p class="brand-subtitle">Gestión Inmobiliaria</p>
            </div>
        </a>
    </div>

    <!-- Navigation Container -->
    <nav class="sidebar-nav">
        <div class="nav-section">
            <h3 class="nav-section-title">Principal</h3>
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="{% url 'core:dashboard' %}" 
                       class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <i class="bi bi-grid-3x3-gap"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'properties:property_list' %}" 
                       class="nav-link {% if request.resolver_match.url_name == 'property_list' %}active{% endif %}">
                        <i class="bi bi-house"></i>
                        <span>Propiedades</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{% url 'customers:customer_list' %}" 
                       class="nav-link {% if request.resolver_match.url_name == 'customer_list' %}active{% endif %}">
                        <i class="bi bi-people"></i>
                        <span>Clientes</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="nav-section">
            <h3 class="nav-section-title">Gestión</h3>
            <ul class="nav-list">

                <li class="nav-item nav-dropdown">
                    <button class="nav-link dropdown-btn {% if request.resolver_match.app_name == 'contracts' %}active{% endif %}" 
                            data-bs-toggle="collapse" data-bs-target="#contractsMenu" aria-expanded="false">
                        <i class="bi bi-file-earmark-text"></i>
                        <span>Contratos</span>
                        <i class="bi bi-chevron-down dropdown-icon"></i>
                    </button>
                    <div class="collapse nav-submenu" id="contractsMenu">
                        <a href="{% url 'contracts:contract_list' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'contract_list' %}active{% endif %}">
                            <i class="bi bi-list-ul"></i>
                            <span>Listar Contratos</span>
                        </a>
                        <a href="{% url 'contracts:contract_create' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'contract_create' %}active{% endif %}">
                            <i class="bi bi-plus-circle"></i>
                            <span>Nuevo Contrato</span>
                        </a>
                    </div>
                </li>
                <li class="nav-item nav-dropdown">
                    <button class="nav-link dropdown-btn {% if request.resolver_match.app_name == 'accounting' %}active{% endif %}" 
                            data-bs-toggle="collapse" data-bs-target="#accountingMenu" aria-expanded="false">
                        <i class="bi bi-calculator"></i>
                        <span>Contabilidad</span>
                        <i class="bi bi-chevron-down dropdown-icon"></i>
                    </button>
                    <div class="collapse nav-submenu" id="accountingMenu">
                        <a href="{% url 'accounting:invoice_list' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'invoice_list' %}active{% endif %}">
                            <i class="bi bi-receipt"></i>
                            <span>Facturas</span>
                        </a>
                        <a href="{% url 'accounting:invoice_create' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'invoice_create' %}active{% endif %}">
                            <i class="bi bi-plus-circle"></i>
                            <span>Nueva Factura</span>
                        </a>
                        <a href="{% url 'accounting:owner_receipts_list' %}" 
                           class="nav-sublink {% if 'owner_receipt' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="bi bi-file-earmark-check"></i>
                            <span>Comprobantes</span>
                        </a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="{% url 'agents:agent_list' %}" 
                       class="nav-link {% if request.resolver_match.url_name == 'agent_list' and request.resolver_match.app_name == 'agents' %}active{% endif %}">
                        <i class="bi bi-person-badge"></i>
                        <span>Agentes</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="nav-section">
            <h3 class="nav-section-title">Sistema</h3>
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="{% url 'accounting:invoice_notifications' %}" 
                       class="nav-link {% if request.resolver_match.url_name == 'invoice_notifications' %}active{% endif %}">
                        <i class="bi bi-bell"></i>
                        <span>Notificaciones</span>
                        {% if unread_notifications_count > 0 %}
                        <span class="notification-badge">{{ unread_notifications_count }}</span>
                        {% endif %}
                    </a>
                </li>
                <li class="nav-item nav-dropdown">
                    <button class="nav-link dropdown-btn {% if 'configuracion' in request.path or request.resolver_match.url_name == 'company_settings' %}active{% endif %}" 
                            data-bs-toggle="collapse" data-bs-target="#configMenu" aria-expanded="false">
                        <i class="bi bi-gear"></i>
                        <span>Configuración</span>
                        {% if has_pending_config_changes %}
                        <span class="notification-badge warning">!</span>
                        {% endif %}
                        <i class="bi bi-chevron-down dropdown-icon"></i>
                    </button>
                    <div class="collapse nav-submenu" id="configMenu">
                        <a href="{% url 'core:company_configuration' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'company_configuration' %}active{% endif %}">
                            <i class="bi bi-building"></i>
                            <span>Panel Principal</span>
                        </a>
                        <a href="{% url 'core:company_basic_info' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'company_basic_info' %}active{% endif %}">
                            <i class="bi bi-info-circle"></i>
                            <span>Datos Básicos</span>
                        </a>
                        <a href="{% url 'core:contact_info' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'contact_info' %}active{% endif %}">
                            <i class="bi bi-telephone"></i>
                            <span>Contacto</span>
                        </a>
                        <a href="{% url 'core:system_configuration' %}" 
                           class="nav-sublink {% if request.resolver_match.url_name == 'system_configuration' %}active{% endif %}">
                            <i class="bi bi-sliders"></i>
                            <span>Sistema</span>
                        </a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- User Profile Section -->
    <div class="sidebar-footer">
        <div class="user-profile dropdown">
            <button class="user-profile-btn" data-bs-toggle="dropdown" aria-expanded="false">
                {% load static %}
                <div class="user-avatar">
                    {% if user.image_path %}
                    <img src="{{ user.image_path.url }}" alt="{{ user.get_full_name }}">
                    {% else %}
                    <div class="avatar-placeholder">
                        <i class="bi bi-person"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="user-info">
                    <span class="user-name">{{ user.get_full_name }}</span>
                    <span class="user-role">Administrador</span>
                </div>
                <i class="bi bi-three-dots"></i>
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a class="dropdown-item" href="{% url 'agents:profile' %}">
                        <i class="bi bi-person-circle"></i>
                        <span>Mi Perfil</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'core:company_settings' %}">
                        <i class="bi bi-gear"></i>
                        <span>Configuración</span>
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item logout" href="{% url 'agents:logout' %}">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Cerrar Sesión</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>