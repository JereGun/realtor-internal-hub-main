{% load humanize %}
<div class="col">
    <div class="card h-100 property-card property-card-enhanced property-transition-all property-hover-lift">
        <div class="property-image-container position-relative">
            {% if property.cover_image %}
                <img src="{{ property.cover_image.image.url }}" class="property-image" alt="{{ property.title }}" loading="lazy">
            {% else %}
                <div class="property-image-placeholder">
                    <i class="bi bi-building property-placeholder-icon"></i>
                </div>
            {% endif %}
            
            <!-- Property Badges -->
            <div class="property-badges">
                <span class="property-badge property-badge-type">{{ property.property_type }}</span>
                <span class="property-badge property-badge-status {% if property.property_status.name == 'Disponible' %}property-badge-success{% elif property.property_status.name == 'Vendida' %}property-badge-danger{% elif property.property_status.name == 'Alquilada' %}property-badge-warning{% else %}property-badge-secondary{% endif %}">
                    {{ property.property_status }}
                </span>
            </div>
            
            {% if property.tags.all %}
            <div class="property-tags">
                {% for tag in property.tags.all|slice:":2" %}
                <span class="property-tag" style="background-color: {{ tag.color }};">{{ tag.name }}</span>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Hover Overlay with Quick Actions -->
            <div class="property-overlay">
                <div class="property-quick-actions">
                    <a href="{% url 'properties:property_detail' property.pk %}" class="property-quick-action" title="Ver detalles">
                        <i class="bi bi-eye-fill"></i>
                    </a>
                    <a href="{% url 'properties:property_edit' property.pk %}" class="property-quick-action" title="Editar">
                        <i class="bi bi-pencil-fill"></i>
                    </a>
                    <button class="property-quick-action" title="Favorito" onclick="toggleFavorite({{ property.pk }})">
                        <i class="bi bi-heart"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="property-content">
            <div class="property-header">
                <h5 class="property-title">{{ property.title|truncatechars:50 }}</h5>
                <p class="property-location">
                    <i class="bi bi-geo-alt-fill property-location-icon"></i> 
                    {{ property.locality|default_if_none:property.neighborhood|default_if_none:"Ubicación no especificada"|truncatechars:35 }}
                </p>
            </div>
            
            <div class="property-features">
                <div class="property-feature">
                    <i class="bi bi-rulers property-feature-icon" data-bs-toggle="tooltip" title="Superficie Total"></i>
                    <span class="property-feature-value">{{ property.total_surface|floatformat:"0" }} m²</span>
                </div>
                <div class="property-feature">
                    <i class="bi bi-door-closed property-feature-icon" data-bs-toggle="tooltip" title="Dormitorios"></i>
                    <span class="property-feature-value">{{ property.bedrooms }} dorm.</span>
                </div>
                <div class="property-feature">
                    <i class="bi bi-droplet-half property-feature-icon" data-bs-toggle="tooltip" title="Baños"></i>
                    <span class="property-feature-value">{{ property.bathrooms }} baños</span>
                </div>
            </div>
            
            <div class="property-pricing">
                {% if property.listing_type == 'sale' or property.listing_type == 'both' %}
                    {% if property.sale_price %}
                        <div class="property-price property-price-sale">
                            <span class="property-price-label">Venta:</span>
                            <span class="property-price-amount">${{ property.sale_price|floatformat:0|intcomma }}</span>
                        </div>
                    {% endif %}
                {% endif %}
                {% if property.listing_type == 'rent' or property.listing_type == 'both' %}
                    {% if property.rental_price %}
                        <div class="property-price property-price-rent">
                            <span class="property-price-label">Alquiler:</span>
                            <span class="property-price-amount">${{ property.rental_price|floatformat:0|intcomma }}/mes</span>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
            
            <div class="property-actions">
                <a href="{% url 'properties:property_detail' property.pk %}" class="property-btn property-btn-primary property-btn-sm">
                    <i class="bi bi-eye-fill"></i> Ver Detalles
                </a>
                <a href="{% url 'properties:property_edit' property.pk %}" class="property-btn property-btn-outline-primary property-btn-sm">
                    <i class="bi bi-pencil-fill"></i> Editar
                </a>
            </div>
        </div>
        <div class="property-footer">
            <div class="property-agent">
                <i class="bi bi-person-circle property-agent-icon"></i> 
                <span class="property-agent-name">{{ property.agent.short_name|default:"N/A" }}</span>
            </div>
            <div class="property-updated">
                <i class="bi bi-clock-history property-updated-icon"></i> 
                <span class="property-updated-time">{{ property.updated_at|timesince }}</span>
            </div>
        </div>
    </div>
</div>
