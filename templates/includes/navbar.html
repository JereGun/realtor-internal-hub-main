<div class="sidebar bg-light position-fixed d-flex flex-column p-3 vh-100 shadow-sm" style="width: 250px;" id="sidebar">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'properties:property_list' %}" class="navbar-brand d-flex align-items-center">
            <i class="bi bi-house-door fs-4 me-2"></i> <strong>InmoGest</strong>
        </a>
        <button class="btn btn-sm btn-light border-0 text-secondary" onclick="toggleSidebar()" title="Colapsar menú">
            <i class="bi bi-chevron-double-left"></i>
        </button>
    </div>

    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            <a href="{% url 'core:dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="bi bi-speedometer2 me-2"></i> Dashboard
            </a>
        </li>

        <li class="nav-item">
            <a href="{% url 'properties:property_list' %}" class="nav-link {% if request.resolver_match.url_name == 'property_list' %}active{% endif %}">
                <i class="bi bi-house me-2"></i> Propiedades
            </a>
        </li>

        <li class="nav-item">
            <a href="{% url 'customers:customer_list' %}" class="nav-link {% if request.resolver_match.url_name == 'customer_list' %}active{% endif %}">
                <i class="bi bi-people me-2"></i> Clientes
            </a>
        </li>

        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="accountingDropdown" role="button" data-bs-toggle="dropdown">
                <i class="bi bi-calculator me-2"></i> Contabilidad
            </a>
            <ul class="dropdown-menu dropdown-menu-light">
                <li>
                    <a class="dropdown-item" href="{% url 'accounting:invoice_list' %}">Facturas</a>
                </li>
                <li>
                    <a class="dropdown-item" href="{% url 'accounting:invoice_create' %}">Nueva Factura</a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item disabled" href="#">Reportes (próximamente)</a></li>
            </ul>
        </li>

        <li class="nav-item">
            <a href="{% url 'agents:agent_list' %}" class="nav-link {% if request.resolver_match.url_name == 'agent_list' %}active{% endif %}">
                <i class="bi bi-person-badge me-2"></i> Agentes
            </a>
        </li>
    </ul>

    <div class="mt-auto pt-3 border-top">
        <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            
            {% if agent.image_path %}
                <img src="{{ user.image_path.url }}" alt="{{Perfil}}" width="32" height="32" class="rounded-circle me-2">
            {% else %}
                <img src="static/default-profile.png" alt="{{Perfil}}" width="32" height="32" class="rounded-circle me-2">
            {% endif %}
            <strong>{{ user.get_full_name }}</strong>
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{% url 'agents:profile' %}"><i class="bi bi-person-circle me-2"></i> Mi Perfil</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i> Configuración</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="{% url 'agents:logout' %}"><i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión</a></li>
        </ul>
    </div>
</div>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('d-none');
    const collapsed = sidebar.classList.contains('d-none');
    localStorage.setItem('sidebarCollapsed', collapsed);
    document.body.classList.toggle('sidebar-collapsed', collapsed);
}

window.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('sidebar');
    if (localStorage.getItem('sidebarCollapsed') === 'true') {
        sidebar.classList.add('d-none');
        document.body.classList.add('sidebar-collapsed');
    }
});
</script>
